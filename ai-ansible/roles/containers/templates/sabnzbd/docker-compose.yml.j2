---
###########################################################################
# SABnzbd - Usenet Download Client
# Deployed by Ansible - Do not edit manually
# Documentation: https://docs.linuxserver.io/images/docker-sabnzbd
###########################################################################

services:
  sabnzbd:
    image: {{ sabnzbd_image | default('lscr.io/linuxserver/sabnzbd:latest') }}
    container_name: {{ sabnzbd_container_name | default('sabnzbd') }}
    restart: unless-stopped
    environment:
      - PUID={{ container_puid }}
      - PGID={{ container_pgid }}
      - TZ={{ container_timezone }}
    volumes:
      - {{ container_data_root }}/sabnzbd:/config
      - {{ container_media_root }}:/mnt/media
      - {{ container_temp_root }}:/mnt/temporary
    ports:
      - "{{ container_ports.sabnzbd }}:8080"
    networks:
      - {{ container_network }}
{% if inventory_hostname in groups['proxy'] %}
      - proxy
{% endif %}
    labels:
      - traefik.enable=true
{% if inventory_hostname in groups['proxy'] %}
      - traefik.docker.network=proxy
{% endif %}
      # Router
      - traefik.http.routers.sabnzbd.service=sabnzbd
      - traefik.http.routers.sabnzbd.rule=Host(`sabnzbd.{{ cloudflare_dns_zone }}`)
      - traefik.http.routers.sabnzbd.entrypoints=secureweb
      - traefik.http.routers.sabnzbd.middlewares=security-headers@file,traefik-bouncer@file,ipAllowList@file
      # Service
      - traefik.http.services.sabnzbd.loadbalancer.server.scheme=http
      - traefik.http.services.sabnzbd.loadbalancer.server.port=8080

networks:
  {{ container_network }}:
    external: true
{% if inventory_hostname in groups['proxy'] %}
  proxy:
    external: true
{% endif %}
